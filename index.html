<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Nabokjip | QR Menu</title>

    <!-- ✅ 라이트 모드 힌트 강화 -->
    <meta name="color-scheme" content="light" />
    <meta name="supported-color-schemes" content="light" />
    <meta name="theme-color" content="#fffaea" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#fffaea" />

    <style>
      @font-face {
        font-family: "ChungjuKimsaeng";
        src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2312-1@1.1/ChungjuKimSaengTTF.woff2") format("woff2");
        font-display: swap;
      }

      :root {
        --primary: #fffaea;
        --accent: #332d2b;
        --page-bottom-gap: 8px;
      }

      * { box-sizing: border-box; }

      html, body {
        margin: 0;
        background: var(--primary) !important;
        color: var(--accent) !important;
        font-family: ChungjuKimsaeng, ui-sans-serif, system-ui, -apple-system,
          Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans JP, Noto Sans KR, sans-serif;
        color-scheme: light !important;
        filter: none !important;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: #fffaea !important;
        pointer-events: none;
        z-index: -1;
        isolation: isolate;
        mix-blend-mode: normal !important;
        filter: none !important;
      }

      img, picture, video, canvas {
        filter: none !important;
        mix-blend-mode: normal !important;
        background: transparent !important;
      }

      .wrap {
        max-width: 800px;
        margin: 0 auto;
        padding: 16px;
        padding-bottom: calc(env(safe-area-inset-bottom, 0px) + var(--page-bottom-gap));
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: clamp(10px, 4vw, 24px);
      }

      .langpicker { display: flex; gap: 8px; align-items: center; }

      .langbtn {
        font-family: ChungjuKimsaeng;
        appearance: none;
        border: none;
        background: transparent;
        color: var(--accent);
        font-weight: bold;
        font-size: 14px;
        padding: 6px 6px;
        border-radius: 999px;
        cursor: pointer;
        filter: none !important;
      }
      .langbtn:hover, .langbtn.active { text-decoration: underline; }

      .card { background: transparent; border: 0; border-radius: 0; }

      .panel { display: none; }
      .panel[aria-hidden="false"] { display: block; }

      .imgbox img { width: 100%; height: auto; display: block; border-radius: 0; }
      .imgbox:not(:last-child) { margin-bottom: 28px; } /* ✅ 이미지 간격 넓힘 */

      .logo { width: auto; min-width: 100px; max-width: 20%; display: block; }

      @media (max-width: 600px) {
        .card { margin-top: 14px; }
        .imgbox:first-of-type { margin-top: 10px; }
        .langbtn { font-size: 15px; }
        .imgbox:not(:last-child) { margin-bottom: 24px; } /* 모바일 약간 좁게 */
      }

      /* ✅ 삼성 강제 다크 모드 역보정 */
      html.force-light, html.force-light body {
        filter: invert(1) hue-rotate(180deg) !important;
      }
      html.force-light img,
      html.force-light picture,
      html.force-light video,
      html.force-light canvas {
        filter: invert(1) hue-rotate(180deg) !important;
        mix-blend-mode: normal !important;
        background: transparent !important;
      }

      @media (prefers-color-scheme: dark) {
        html, body { background: #fffaea !important; color: var(--accent) !important; }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <header>
        <img src="./assets/logo.png" alt="logo" class="logo" loading="lazy" />
        <nav class="langpicker" aria-label="언어 선택">
          <button class="langbtn" data-lang="en" aria-label="English">EN</button>
          <button class="langbtn" data-lang="ja" aria-label="日本語">日本語</button>
          <button class="langbtn" data-lang="zh" aria-label="中文">中文</button>
        </nav>
      </header>

      <section class="card">
        <!-- 영어 -->
        <div id="panel-en" class="panel" role="region" aria-hidden="false">
          <div class="imgbox">
            <img src="./assets/menu_en_1.png" alt="Menu (English)" loading="lazy" />
          </div>
          <div class="imgbox">
            <img src="./assets/menu_en_2.png" alt="Menu (English)" loading="lazy" />
          </div>
        </div>

        <!-- 일본어 -->
        <div id="panel-ja" class="panel" role="region" aria-hidden="true">
          <div class="imgbox">
            <img src="./assets/menu_ja_1.png" alt="Menu (日本語)" loading="lazy" />
          </div>
          <div class="imgbox">
            <img src="./assets/menu_ja_2.png" alt="Menu (日本語)" loading="lazy" />
          </div>
        </div>

        <!-- 중국어 -->
        <div id="panel-zh" class="panel" role="region" aria-hidden="true">
          <div class="imgbox">
            <img src="./assets/menu_zh_1.png" alt="Menu (中文)" loading="lazy" />
          </div>
          <div class="imgbox">
            <img src="./assets/menu_zh_2.png" alt="Menu (中文)" loading="lazy" />
          </div>
        </div>
      </section>
    </div>

    <script>
      // ✅ 하단 여백 자동 조정
      function tuneGap() {
        const vh = window.visualViewport ? visualViewport.height : innerHeight;
        let gap = 8;
        if (vh < 700) gap = 4;
        else if (vh > 900) gap = 12;
        document.documentElement.style.setProperty("--page-bottom-gap", gap + "px");
      }
      tuneGap();
      addEventListener("resize", tuneGap);
      if (window.visualViewport) visualViewport.addEventListener("resize", tuneGap);

      // ✅ 삼성 브라우저 강제 다크모드 감지 및 복구
      (function () {
        var isSamsung = /SamsungBrowser/i.test(navigator.userAgent);
        var prefersDark = window.matchMedia && matchMedia("(prefers-color-scheme: dark)").matches;

        function applyForceLightIfNeeded() {
          if (isSamsung && prefersDark) {
            document.documentElement.classList.add("force-light");
          } else {
            document.documentElement.classList.remove("force-light");
          }
        }

        applyForceLightIfNeeded();

        if (window.matchMedia) {
          try {
            matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
              prefersDark = e.matches;
              applyForceLightIfNeeded();
            });
          } catch (_) {
            var mq = matchMedia("(prefers-color-scheme: dark)");
            mq.addListener(function (e) {
              prefersDark = e.matches;
              applyForceLightIfNeeded();
            });
          }
        }

        window.addEventListener("pageshow", applyForceLightIfNeeded);
        window.addEventListener("resize", applyForceLightIfNeeded);
        if (window.visualViewport) visualViewport.addEventListener("resize", applyForceLightIfNeeded);
      })();

      // ✅ 언어 전환
      function detectInitialLang() {
        const qp = new URLSearchParams(location.search).get("lang");
        if (qp && ["en", "ja", "zh"].includes(qp)) return qp;
        const sys = (navigator.languages && navigator.languages[0]) || navigator.language || "";
        if (sys.toLowerCase().startsWith("ja")) return "ja";
        if (sys.toLowerCase().startsWith("zh")) return "zh";
        return "en";
      }

      function showLang(lang) {
        ["en", "ja", "zh"].forEach((code) => {
          const panel = document.getElementById(`panel-${code}`);
          if (panel) panel.setAttribute("aria-hidden", code !== lang);
        });
        document.querySelectorAll(".langbtn").forEach((b) => {
          b.classList.toggle("active", b.dataset.lang === lang);
        });
        const url = new URL(location.href);
        url.searchParams.set("lang", lang);
        history.replaceState(null, "", url.toString());
      }

      document.addEventListener("DOMContentLoaded", () => {
        const initial = detectInitialLang();
        showLang(initial);
        document.querySelectorAll(".langbtn").forEach((btn) => {
          btn.addEventListener("click", () => showLang(btn.dataset.lang));
        });
      });
    </script>
  </body>
</html>
